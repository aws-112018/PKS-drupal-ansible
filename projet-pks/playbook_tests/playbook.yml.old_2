---
- name: "Ubuntu LAMP server with Drupal Play"
  hosts: all
  become: yes
  vars_files:
    - vars.yml
  pre_tasks:
    - name: "Update apt cache if needed."
      apt:
        update_cache: yes
        cache_valid_time: 3600
  handlers:
    - import_tasks: handlers/handlers.yml
  tasks:
    - name: "Get software for apt repository management."
      apt:
        name:
          - python-apt
          - python-pycurl
        state: present
    - name: "Add ondrej repository for later versions of PHP."
      apt_repository:
        repo: 'ppa:ondrej/php'
        update_cache: yes
    - name: "Install other dependencies"
      apt:
        name:
          - git
          - curl
          - unzip
          - sendmail
          - libpcre3-dev
          - libapache2-mod-php7.1
          - python-mysqldb
          - ufw
        state: present
    - name: "Disable the firewall (since this is for local dev only)."
      service:
        name: ufw
        state: stopped
    - import_tasks: tasks/apache.yml
      debug:
        msg: "Import apache.yml = OK"
    - import_tasks: tasks/php.yml
      debug:
        msg: "Import php.yml = OK"
    - import_tasks: tasks/mysql.yml
      debug:
        msg: "Import mysql.yml = OK"
    - import_tasks: tasks/composer.yml
      debug:
        msg: "Import composer.yml = OK"
    - import_tasks: tasks/drush.yml
      debug:
        msg: "Import drush.yml = OK"
    - import_tasks: tasks/drupal.yml
      debug:
        msg: "Import drupal.yml = OK"
